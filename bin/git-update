#!/bin/sh
#
# Called on upload to update the main web directory

# --- Command line
refname="$1"
oldrev="$2"
newrev="$3"

# We only care about master
if [ "refs/heads/master" = "${refname}" ]; then
  WORKDIR=`mktemp -d -t wwwtest` || exit 1
  trap 'rm -rf ${WORKDIR}' EXIT
  git archive "${newrev}" | tar xfC - ${WORKDIR} || exit $?
  ( cd ${WORKDIR} && make HTMLDIR=/var/www/html -s install ) || exit $?
fi
